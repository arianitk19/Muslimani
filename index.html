<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Vaktia Ratkoc</title>
    <link rel="manifest" href="manifest.json">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="Images/604776747_122280490772225847_4370550408157022665_n.jpg">

    <script>
        // Mban aplikacionin brenda dritares në iOS
        (function(a, b, c) {
            if (c in b && b[c]) {
                var d, e = a.location, f = /^(a|html)$/i;
                a.addEventListener("click", function(a) {
                    d = a.target;
                    while (!f.test(d.nodeName)) d = d.parentNode;
                    if ("href" in d && (d.href.indexOf("http") || ~d.href.indexOf(e.host))) {
                        a.preventDefault();
                        e.href = d.href;
                    }
                }, !1)
            }
        })(document, window.navigator, "standalone");
    </script>

    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/mosque.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #10b981;
            --bg: #020617;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
        }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 2rem;
            transition: all 0.4s ease;
        }

        /* Stilimi i ikonave - Korigjuar për versionin Free */
        .vakt-icon-container {
            width: 45px;
            height: 45px;
            margin: 0 auto 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            background: rgba(255,255,255,0.03);
            transition: 0.3s;
        }

        .vakt-icon-container i { font-size: 1.2rem; color: rgba(255,255,255,0.3); }

        /* Stilimi kur vaktia është AKTIVE */
        .active.glass-card { border-color: var(--primary); background: rgba(16, 185, 129, 0.05); }
        .active .vakt-icon-container { background: var(--primary); color: #020617 !important; box-shadow: 0 0 15px var(--primary); }
        .active .vakt-icon-container i { color: #020617 !important; }

        /* Progress Circle */
        .progress-ring__circle { transition: stroke-dashoffset 0.5s ease; stroke: var(--primary); }

        /* Menu */
        .menu-trigger { position: fixed; top: 2rem; right: 1.5rem; z-index: 2000; padding: 10px; background: var(--glass); border-radius: 1rem; border: 1px solid var(--border); }
        .burger-line { width: 20px; height: 2px; background: var(--primary); margin: 4px 0; transition: 0.4s; }
        #full-menu { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98); backdrop-filter: blur(40px); z-index: 1999; display: flex; flex-direction: column; justify-content: center; padding: 3rem; visibility: hidden; opacity: 0; transition: 0.4s; }
        #full-menu.active { visibility: visible; opacity: 1; }
        
        .task-btn.done { background: var(--primary) !important; color: #020617 !important; box-shadow: 0 0 10px var(--primary); }
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body class="pb-12">

    <div id="celebration-modal" class="fixed inset-0 z-[3000] hidden items-center justify-center p-8 backdrop-blur-xl bg-black/80">
        <div class="glass-card p-10 text-center max-w-xs">
            <div class="w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-check text-emerald-500 text-2xl"></i>
            </div>
            <h2 class="text-2xl font-black mb-2 italic">MashAllah!</h2>
            <p class="text-gray-400 text-sm italic">Allahu ta pranoftë ibadetin tënd.</p>
            <button onclick="closeCelebration()" class="mt-8 bg-emerald-500 text-black font-black py-3 px-8 rounded-2xl w-full uppercase tracking-widest text-xs">Amin</button>
        </div>
    </div>

    <div class="menu-trigger" onclick="toggleMenu()">
        <div class="burger-line"></div>
        <div class="burger-line"></div>
    </div>

    <nav id="full-menu">
        <a href="index.html" class="text-3xl font-bold mb-6 text-emerald-500"><i class="fa-solid fa-house-chimney mr-4"></i>Vaktia</a>
        <a href="lutje.html" class="text-3xl font-bold mb-6 opacity-50"><i class="fa-solid fa-hand-holding-heart mr-4"></i>Lutjet</a>
        <a href="kibla.html" class="text-3xl font-bold mb-6 opacity-50"><i class="fa-solid fa-compass mr-4"></i>Kibla</a>
        <div class="mt-auto pt-10 border-t border-white/5 opacity-30 text-[10px] tracking-widest uppercase">Ratkoci Digital © 2026</div>
    </nav>

    <header class="pt-20 px-8 text-center">
        <div class="max-w-md mx-auto mb-10">
            <h2 class="text-5xl font-black tracking-tighter mb-2 italic">Selam Alejkum<span class="text-emerald-500">.</span></h2>
            <p id="hijri-date-top" class="text-[10px] uppercase tracking-[0.3em] text-emerald-500 font-bold opacity-70"></p>
        </div>

        <div class="relative inline-block">
            <svg width="220" height="220">
                <circle class="text-white/5" stroke-width="2" stroke="currentColor" fill="transparent" r="95" cx="110" cy="110"/>
                <circle id="progress-bar" class="progress-ring__circle" stroke-width="3" stroke-dasharray="596.9" stroke-dashoffset="596.9" stroke-linecap="round" fill="transparent" r="95" cx="110" cy="110" transform="rotate(-90 110 110)"/>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span id="live-clock" class="text-5xl font-black tracking-tighter italic">00:00</span>
                <span class="text-[9px] uppercase tracking-[0.4em] text-gray-500 font-bold mt-2">Koha Lokale</span>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-6 mt-12 space-y-6">
        <div class="glass-card p-8 text-center relative overflow-hidden bg-gradient-to-br from-white/5 to-transparent">
            <p class="text-[10px] uppercase tracking-[0.5em] text-emerald-500 font-black mb-2">I Radhës</p>
            <h3 id="next-prayer-name" class="text-5xl font-black italic tracking-tighter mb-4">-</h3>
            <div class="inline-flex items-center gap-3 px-6 py-2 rounded-2xl bg-black/40 border border-white/5">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span id="prayer-countdown" class="text-sm font-bold font-mono tracking-widest text-emerald-500">00:00:00</span>
            </div>
        </div>

        <div id="vaktet-list" class="grid grid-cols-2 gap-4"></div>

        <div class="glass-card p-6">
            <div class="flex justify-between items-center mb-6">
                <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400">Namazi Ditor</h4>
                <p id="task-count" class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">0/5</p>
            </div>
            
            <div class="grid grid-cols-5 gap-3 mb-8">
                <button onclick="toggleTask(0)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black">S</button>
                <button onclick="toggleTask(1)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black">D</button>
                <button onclick="toggleTask(2)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black">I</button>
                <button onclick="toggleTask(3)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black">A</button>
                <button onclick="toggleTask(4)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black">J</button>
            </div>

            <div class="pt-6 border-t border-white/5 flex items-center justify-between">
                <div class="flex flex-col">
                    <span id="dhiker-label" class="text-sm font-bold italic">SubhanAllah</span>
                    <span class="text-[9px] text-emerald-500 uppercase font-black tracking-widest">Dhikri</span>
                </div>
                <button onclick="incrementTasbih()" class="w-16 h-16 rounded-3xl bg-emerald-500 flex items-center justify-center shadow-xl shadow-emerald-500/20 active:scale-95 transition-all">
                    <span id="tasbih-num" class="text-xl font-black text-slate-900">0</span>
                </button>
            </div>
        </div>
    </main>

    <script>
        // Korigjuar ikonat për FontAwesome Free
        const vaktetRaw = [
            { emri: 'Sabahu', koha: '05:30', ikona: 'fa-cloud-sun' },
            { emri: 'Lindja', koha: '07:05', ikona: 'fa-sun' },
            { emri: 'Dreka', koha: '11:48', ikona: 'fa-sun' },
            { emri: 'Ikindia', koha: '14:12', ikona: 'fa-cloud' },
            { emri: 'Akshami', koha: '16:21', ikona: 'fa-mountain-sun' },
            { emri: 'Jacia', koha: '17:54', ikona: 'fa-moon' }
        ];

        function toggleMenu() {
            document.getElementById('full-menu').classList.toggle('active');
        }

        const dhikret = ["SubhanAllah", "Elhamdulillah", "Allahu Akbar", "Estagfirullah", "La ilaha illallah"];
        let dhikerIndex = 0;
        let tasbihCount = parseInt(localStorage.getItem('tasbihCount')) || 0;
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [false, false, false, false, false];

        function incrementTasbih() {
            tasbihCount++;
            if (navigator.vibrate) navigator.vibrate(20);
            if(tasbihCount > 33) {
                tasbihCount = 1;
                dhikerIndex = (dhikerIndex + 1) % dhikret.length;
                document.getElementById('dhiker-label').innerText = dhikret[dhikerIndex];
            }
            document.getElementById('tasbih-num').innerText = tasbihCount;
            localStorage.setItem('tasbihCount', tasbihCount);
        }

        function toggleTask(idx) {
            completedTasks[idx] = !completedTasks[idx];
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            updateTasksUI();
            if (completedTasks.filter(t => t).length === 5) showCelebration();
        }

        function showCelebration() { document.getElementById('celebration-modal').style.display = 'flex'; }
        function closeCelebration() { document.getElementById('celebration-modal').style.display = 'none'; }

        function updateTasksUI() {
            const btns = document.querySelectorAll('.task-btn');
            completedTasks.forEach((s, i) => {
                s ? btns[i].classList.add('done') : btns[i].classList.remove('done');
            });
            document.getElementById('task-count').innerText = `${completedTasks.filter(t => t).length}/5 Namaze`;
        }

        function updateUI() {
            const now = new Date();
            const currentTotalMin = (now.getHours() * 60) + now.getMinutes();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString('sq-AL', {hour12: false, hour: '2-digit', minute: '2-digit'});
            
            let currentIdx = -1;
            const listHtml = vaktetRaw.map((v, i) => {
                const [vh, vm] = v.koha.split(':').map(Number);
                const vMin = vh * 60 + vm;
                if (currentTotalMin >= vMin) currentIdx = i;
                const isNow = (i === currentIdx);
                const passed = (currentTotalMin > vMin) && !isNow;
                
                return `
                <div class="glass-card p-5 text-center ${isNow ? 'active' : ''} ${passed ? 'opacity-30' : ''}">
                    <div class="vakt-icon-container">
                        <i class="fa-solid ${v.ikona}"></i>
                    </div>
                    <span class="text-[9px] uppercase font-black tracking-widest text-gray-500 block mb-1">${v.emri}</span>
                    <span class="text-xl font-bold italic">${v.koha}</span>
                </div>`;
            }).join('');
            
            document.getElementById('vaktet-list').innerHTML = listHtml;
            
            // Next Prayer Logic
            const nextIdx = (currentIdx + 1) % vaktetRaw.length;
            const nextP = vaktetRaw[nextIdx];
            document.getElementById('next-prayer-name').innerText = nextP.emri;
            
            const [nh, nm] = nextP.koha.split(':').map(Number);
            let target = new Date(); target.setHours(nh, nm, 0);
            if (target < now) target.setDate(target.getDate() + 1);
            
            const diff = target - now;
            const h = Math.floor(diff/3600000).toString().padStart(2,'0');
            const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
            document.getElementById('prayer-countdown').innerText = `${h}:${m}:${s}`;
            
            const totalSec = (now.getHours()*3600) + (now.getMinutes()*60) + now.getSeconds();
            document.getElementById('progress-bar').style.strokeDashoffset = 596.9 - ((totalSec / 86400) * 596.9);
        }

        async function fetchLiveVaktet() {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timingsByAddress?address=Ratkoc,Kosovo&method=3`);
                const data = await res.json();
                const t = data.data.timings;
                vaktetRaw[0].koha = t.Fajr;
                vaktetRaw[1].koha = t.Sunrise;
                vaktetRaw[2].koha = t.Dhuhr;
                vaktetRaw[3].koha = t.Asr;
                vaktetRaw[4].koha = t.Maghrib;
                vaktetRaw[5].koha = t.Isha;
                updateUI();
            } catch (e) { console.warn("API Error"); }
        }

        window.onload = () => {
            fetchLiveVaktet();
            updateTasksUI();
            const options = { day: 'numeric', month: 'long', year: 'numeric', calendar: 'islamic-uma' };
            document.getElementById('hijri-date-top').innerText = new Intl.DateTimeFormat('sq-u-ca-islamic-uma', options).format(new Date());
            document.getElementById('tasbih-num').innerText = tasbihCount;
            setInterval(updateUI, 1000);
        };
    </script>
</body>
</html>
