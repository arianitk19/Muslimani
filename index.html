<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Perkujtuesi Ditor</title>
    <link rel="manifest" href="manifest.json">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Përkujtuesi">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/512/crescent-moon.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/512/crescent-moon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800;900&display=swap');

        :root {
            --primary: #10b981;
            --bg: #020617;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.07);
        }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* --- PREMIUM PRAYER CARDS --- */
        #vaktet-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
            padding: 1.5rem;
        }

        .vakt-card {
            position: relative;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 2.2rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .vakt-icon-container {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--primary);
            border: 1px solid var(--border);
            transition: 0.4s;
        }

        /* Vakti Aktiv (The Highlight) */
        .vakt-card.active {
            transform: scale(1.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            z-index: 20;
        }

        .vakt-card.active::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.15), transparent);
            pointer-events: none;
        }

        .vakt-card.active .vakt-icon-container {
            background: white;
            color: #000;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Namazet që kanë kaluar */
        .vakt-card.past {
            opacity: 0.3;
            filter: grayscale(0.5);
            transform: scale(0.96);
        }

        .vakt-name {
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 0.25rem;
        }

        .vakt-time {
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        /* --- UI COMPONENTS --- */
        .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 2.5rem;
            backdrop-filter: blur(15px);
        }

        .task-btn {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .task-btn.done {
            background: var(--primary) !important;
            color: var(--bg) !important;
            border-color: var(--primary) !important;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }

        /* --- MENU & PROGRESS --- */
        .menu-trigger {
            position: fixed; top: 2.5rem; right: 1.5rem; z-index: 2000;
            padding: 12px; background: var(--card-bg); border-radius: 1.2rem; border: 1px solid var(--border);
            cursor: pointer; backdrop-filter: blur(10px);
        }
        .burger-line { width: 22px; height: 1.8px; background: var(--primary); margin: 5px 0; transition: 0.4s; }
        .open .line-1 { transform: translateY(6.8px) rotate(45deg); }
        .open .line-2 { opacity: 0; }
        .open .line-3 { transform: translateY(-6.8px) rotate(-45deg); }

        #full-menu {
            position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98); backdrop-filter: blur(50px);
            z-index: 1999; display: flex; flex-direction: column; justify-content: center;
            padding: 3rem; visibility: hidden; opacity: 0; transition: 0.5s;
        }
        #full-menu.active { visibility: visible; opacity: 1; }

        #progress-bar {
            stroke-dasharray: 596.9; stroke-dashoffset: 596.9;
            transition: stroke-dashoffset 1s linear; stroke-linecap: round;
            filter: drop-shadow(0 0 10px var(--primary));
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0px rgba(16, 185, 129, 0.4); }
            100% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
        }
        .vakt-impulse { animation: pulse-glow 2s infinite; }
    </style>
</head>

<body class="pb-12">

    <div id="intro-screen" class="fixed inset-0 z-[5000] flex flex-col items-center justify-center bg-[#020617] transition-all duration-1000">
        <div class="relative z-10 text-center px-6">
            <div class="w-24 h-24 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto border border-emerald-500/30 mb-8">
                <i class="fa-solid fa-mosque text-5xl text-emerald-500"></i>
            </div>
            <h1 class="text-4xl font-black italic tracking-tighter text-white mb-2">Përkujtuesi <span class="text-emerald-500">Ditor</span></h1>
            <p class="text-gray-500 text-[10px] tracking-[0.4em] uppercase mb-12 opacity-70">Paqja qoftë mbi ju</p>
            <button onclick="startApp()" class="px-12 py-4 border border-emerald-500/50 rounded-2xl text-emerald-500 font-bold uppercase tracking-widest text-xs hover:bg-emerald-500 hover:text-black transition-all">Hyni në Faqe</button>
        </div>
    </div>

    <div class="menu-trigger" onclick="toggleMenu()">
        <div class="burger-line line-1"></div>
        <div class="burger-line line-2"></div>
        <div class="burger-line line-3"></div>
    </div>

    <nav id="full-menu">
        <div class="mb-10"><p class="text-emerald-500 font-black tracking-[0.4em] text-[10px] uppercase opacity-50">Navigimi</p></div>
        <a href="index.html" class="text-4xl font-black mb-6 flex items-center gap-4 text-white"><i class="fa-solid fa-house-chimney text-emerald-500 text-2xl"></i> Vaktia</a>
        <a href="lutje.html" class="text-4xl font-black mb-6 flex items-center gap-4 text-gray-600"><i class="fa-solid fa-hand-holding-heart text-emerald-500 text-2xl"></i> Lutjet</a>
        <a href="kibla.html" class="text-4xl font-black mb-6 flex items-center gap-4 text-gray-600"><i class="fa-solid fa-compass text-emerald-500 text-2xl"></i> Kibla</a>
        <a href="info.html" class="text-4xl font-black mb-6 flex items-center gap-4 text-gray-600"><i class="fa-solid fa-circle-info text-emerald-500 text-2xl"></i> Info</a>
    </nav>

    <header class="pt-20 px-8 max-w-md mx-auto">
        <div class="mb-10">
            <h2 class="text-5xl font-black tracking-tighter italic leading-tight">Selam<br>Alejkum<span class="text-emerald-500">.</span></h2>
            <p id="hijri-date-top" class="text-[10px] uppercase tracking-[0.3em] text-emerald-500 font-black mt-3 opacity-80"></p>
        </div>

        <div class="relative w-56 h-56 mx-auto mb-16">
            <svg viewBox="0 0 220 220" class="w-full h-full transform -rotate-90">
                <circle cx="110" cy="110" r="95" stroke="rgba(255,255,255,0.05)" stroke-width="2" fill="none"/>
                <circle id="progress-bar" cx="110" cy="110" r="95" stroke="var(--primary)" stroke-width="3" fill="none"/>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center rotate-0">
                <span id="live-clock" class="text-5xl font-black italic tracking-tighter">00:00</span>
                <span class="text-[8px] uppercase tracking-[0.5em] text-gray-500 font-bold mt-2">Koha Aktuale</span>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-6 space-y-8">
        <div class="glass-card p-10 text-center relative overflow-hidden">
            <div class="absolute -top-4 -right-4 opacity-[0.03] rotate-12">
                <i class="fa-solid fa-mosque text-9xl"></i>
            </div>
            <p class="text-[10px] uppercase tracking-[0.6em] text-emerald-500 font-black mb-3">I Radhës</p>
            <h3 id="next-prayer-name" class="text-6xl font-black italic tracking-tighter mb-6">-</h3>
            <div class="inline-flex items-center gap-3 px-6 py-3 rounded-2xl bg-black/40 border border-white/5">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span id="prayer-countdown" class="text-lg font-black font-mono text-emerald-500">00:00:00</span>
            </div>
        </div>

        <div id="vaktet-list">
            </div>

        <div class="glass-card p-8">
            <div class="flex justify-between items-center mb-8">
                <h4 class="text-[10px] font-black uppercase tracking-[0.3em] text-gray-500">Ecuria Ditore</h4>
                <p id="task-count" class="text-[10px] text-emerald-500 font-black uppercase tracking-widest">0/5</p>
            </div>
            
            <div class="grid grid-cols-5 gap-3 mb-10">
                <button onclick="toggleTask(0)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-black">S</button>
                <button onclick="toggleTask(1)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-black">D</button>
                <button onclick="toggleTask(2)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-black">I</button>
                <button onclick="toggleTask(3)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-black">A</button>
                <button onclick="toggleTask(4)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-black">J</button>
            </div>

            <div class="flex items-center justify-between pt-8 border-t border-white/5">
                <div>
                    <span id="dhiker-label" class="text-lg font-black italic block">SubhanAllah</span>
                    <span class="text-[8px] text-emerald-500 uppercase font-black tracking-[0.3em] opacity-60">Dhikri Aktual</span>
                </div>
                <button onclick="incrementTasbih()" class="w-16 h-16 rounded-[2rem] bg-emerald-500 flex items-center justify-center shadow-lg shadow-emerald-500/20 active:scale-90 transition-all">
                    <span id="tasbih-num" class="text-xl font-black text-black">0</span>
                </button>
            </div>
        </div>
    </main>

    <script>
        const PD_STORE = {
            save(key, val) { localStorage.setItem('pd_' + key, val); },
            get(key, def) { return localStorage.getItem('pd_' + key) || def; }
        };

        let vaktetRaw = [
            { emri: 'Sabahu', koha: '--:--', ikona: 'fa-cloud-moon', gradient: 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)' },
            { emri: 'Lindja', koha: '--:--', ikona: 'fa-sun-haze', gradient: 'linear-gradient(135deg, #334155 0%, #475569 100%)' },
            { emri: 'Dreka', koha: '--:--', ikona: 'fa-sun', gradient: 'linear-gradient(135deg, #0284c7 0%, #0369a1 100%)' },
            { emri: 'Ikindia', koha: '--:--', ikona: 'fa-cloud-sun', gradient: 'linear-gradient(135deg, #d97706 0%, #b45309 100%)' },
            { emri: 'Akshami', koha: '--:--', ikona: 'fa-mountain-sun', gradient: 'linear-gradient(135deg, #4f46e5 0%, #3730a3 100%)' },
            { emri: 'Jacia', koha: '--:--', ikona: 'fa-moon-stars', gradient: 'linear-gradient(135deg, #1e1b4b 0%, #020617 100%)' }
        ];

        let tasbihCount = parseInt(localStorage.getItem('tasbihCount')) || 0;
        let dhikerIndex = 0;
        const dhikret = ["SubhanAllah", "Elhamdulillah", "Allahu Akbar", "Estagfirullah", "La ilaha illallah"];
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [false, false, false, false, false];

        async function fetchVaktet() {
            try {
                const metoda = PD_STORE.get('api_method', '13');
                const offset = parseInt(PD_STORE.get('offset', '0'));
                const res = await fetch(`https://api.aladhan.com/v1/timingsByAddress?address=Prishtina,Kosovo&method=${metoda}`);
                const data = await res.json();
                const t = data.data.timings;

                const vKeys = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                vKeys.forEach((key, idx) => {
                    let [h, m] = t[key].split(':').map(Number);
                    let d = new Date();
                    d.setHours(h, m + offset);
                    vaktetRaw[idx].koha = d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
                });
                renderVaktet();
            } catch (e) { console.error("API Error"); }
        }

        function renderVaktet() {
            const now = new Date();
            const currentTotalMin = now.getHours() * 60 + now.getMinutes();
            let currentIdx = -1;

            vaktetRaw.forEach((v, i) => {
                const [h, m] = v.koha.split(':').map(Number);
                if (currentTotalMin >= (h * 60 + m)) currentIdx = i;
            });

            const html = vaktetRaw.map((v, i) => {
                const isNow = (i === currentIdx);
                const [vh, vm] = v.koha.split(':').map(Number);
                const isPast = (currentTotalMin > (vh * 60 + vm)) && !isNow;

                return `
                    <div class="vakt-card ${isNow ? 'active' : ''} ${isPast ? 'past' : ''}" 
                         style="${isNow ? `background: ${v.gradient}; border: none;` : ''}">
                        <div class="vakt-icon-container">
                            <i class="fa-solid ${v.ikona}"></i>
                        </div>
                        <span class="vakt-name" style="${isNow ? 'color: rgba(255,255,255,0.7)' : ''}">${v.emri}</span>
                        <span class="vakt-time">${v.koha}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('vaktet-list').innerHTML = html;
            updateCountdown(now, currentIdx);
        }

        function updateCountdown(now, currentIdx) {
            const nextIdx = (currentIdx + 1) % vaktetRaw.length;
            const nextP = vaktetRaw[nextIdx];
            document.getElementById('next-prayer-name').innerText = nextP.emri;

            const [nh, nm] = nextP.koha.split(':').map(Number);
            let target = new Date();
            target.setHours(nh, nm, 0);
            if (target < now) target.setDate(target.getDate() + 1);

            const diff = target - now;
            const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
            const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
            const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
            document.getElementById('prayer-countdown').innerText = `${h}:${m}:${s}`;

            // Progress Bar
            const totalSec = (now.getHours() * 3600) + (now.getMinutes() * 60) + now.getSeconds();
            const offset = 596.9 - ((totalSec / 86400) * 596.9);
            document.getElementById('progress-bar').style.strokeDashoffset = offset;
        }

        function startApp() {
            document.getElementById('intro-screen').classList.add('opacity-0', 'pointer-events-none');
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function toggleMenu() {
            const menu = document.getElementById('full-menu');
            const trigger = document.querySelector('.menu-trigger');
            menu.classList.toggle('active');
            trigger.classList.toggle('open');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : 'auto';
        }

        function incrementTasbih() {
            tasbihCount++;
            if (navigator.vibrate) navigator.vibrate(15);
            if (tasbihCount > 33) {
                tasbihCount = 1;
                dhikerIndex = (dhikerIndex + 1) % dhikret.length;
                document.getElementById('dhiker-label').innerText = dhikret[dhikerIndex];
            }
            document.getElementById('tasbih-num').innerText = tasbihCount;
            localStorage.setItem('tasbihCount', tasbihCount);
        }

        function toggleTask(idx) {
            completedTasks[idx] = !completedTasks[idx];
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            updateTasksUI();
            if (navigator.vibrate) navigator.vibrate(30);
        }

        function updateTasksUI() {
            const btns = document.querySelectorAll('.task-btn');
            completedTasks.forEach((s, i) => {
                if(btns[i]) s ? btns[i].classList.add('done') : btns[i].classList.remove('done');
            });
            document.getElementById('task-count').innerText = `${completedTasks.filter(t => t).length}/5 Namaze`;
        }

        function applyGlobalSettings() {
            const primary = PD_STORE.get('primary_color', '#10b981');
            const bg = PD_STORE.get('bg_color', '#020617');
            document.documentElement.style.setProperty('--primary', primary);
            document.documentElement.style.setProperty('--bg', bg);
            document.querySelectorAll('.text-emerald-500').forEach(el => el.style.color = primary);
        }

        window.addEventListener('DOMContentLoaded', () => {
            fetchVaktet();
            applyGlobalSettings();
            updateTasksUI();
            document.getElementById('tasbih-num').innerText = tasbihCount;
            
            const hijriOptions = { day: 'numeric', month: 'long', year: 'numeric', calendar: 'islamic-uma' };
            document.getElementById('hijri-date-top').innerText = new Intl.DateTimeFormat('sq-u-ca-islamic-uma', hijriOptions).format(new Date());

            setInterval(() => {
                const now = new Date();
                document.getElementById('live-clock').innerText = now.toLocaleTimeString('sq-AL', { hour: '2-digit', minute: '2-digit', hour12: false });
                renderVaktet();
            }, 1000);
        });

        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('pd_')) applyGlobalSettings();
        });
    </script>
</body>
</html>
