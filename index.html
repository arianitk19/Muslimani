<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Perkujtuesi Ditor</title>
    <link rel="manifest" href="manifest.json">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="Images/604776747_122280490772225847_4370550408157022665_n.jpg">

    <script>
        (function(a, b, c) {
            if (c in b && b[c]) {
                var d, e = a.location, f = /^(a|html)$/i;
                a.addEventListener("click", function(a) {
                    d = a.target;
                    while (!f.test(d.nodeName)) d = d.parentNode;
                    "href" in d && (d.href.indexOf("http") || ~d.href.indexOf(e.host)) && (a.preventDefault(), e.href = d.href)
                }, !1)
            }
        })(document, window.navigator, "standalone");
    </script>

    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/mosque.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
 <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&display=swap');

    :root {
        --primary: #10b981;
        --bg: #020617;
        --glass: rgba(255, 255, 255, 0.03);
        --border: rgba(255, 255, 255, 0.08);
        --neon-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
    }

    /* --- BAZA --- */
    body {
        background: var(--bg);
        color: white;
        font-family: 'Plus Jakarta Sans', sans-serif;
        min-height: 100vh;
        margin: 0;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
    }

    /* --- PROGRESS RING (NEON) --- */
    .progress-container {
        position: relative;
        width: 220px;
        height: 220px;
        margin: 2rem auto;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #progress-bar {
        stroke-dasharray: 596.9;
        stroke-dashoffset: 596.9;
        transition: stroke-dashoffset 1s linear;
        stroke-linecap: round;
        filter: drop-shadow(0 0 8px var(--primary));
    }

    .progress-bg {
        stroke: rgba(255, 255, 255, 0.05);
    }

    /* --- VAKT CARDS (GLASSMORPISM) --- */
    .glass-card {
        background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 2rem;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .vakt-card {
        position: relative;
        padding: 1.5rem 1rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 120px;
    }

    /* Kur vakti është aktiv (JavaScript shton klasën .active) */
    .vakt-card.active {
        border: none !important;
        transform: scale(1.05);
    }

    .vakt-card.active * {
        color: white !important;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .vakt-icon-container {
        width: 45px;
        height: 45px;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 1rem;
        background: rgba(255,255,255,0.03);
        transition: 0.3s;
    }

    .active .vakt-icon-container {
        background: rgba(255,255,255,0.2);
        box-shadow: 0 0 15px rgba(255,255,255,0.3);
    }

    /* --- EFEKTI IMPULSIV (FOCUS MODE) --- */
    .vakt-impulse {
        animation: pulseGlow 2s infinite ease-in-out !important;
        z-index: 100;
        border: 2px solid var(--primary) !important;
    }

    @keyframes pulseGlow {
        0% { transform: scale(1.05); box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        50% { transform: scale(1.1); box-shadow: 0 0 50px rgba(16, 185, 129, 0.7); }
        100% { transform: scale(1.05); box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
    }

    /* --- MENU --- */
    .menu-trigger {
        position: fixed;
        top: 2.5rem;
        right: 1.5rem;
        z-index: 2000;
        padding: 12px;
        background: var(--glass);
        border-radius: 1.2rem;
        border: 1px solid var(--border);
        cursor: pointer;
    }

    .burger-line {
        width: 22px;
        height: 1.5px;
        background: var(--primary);
        margin: 5px 0;
        transition: 0.4s;
    }

    #full-menu {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.98);
        backdrop-filter: blur(50px);
        -webkit-backdrop-filter: blur(50px);
        z-index: 1999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 3rem;
        visibility: hidden;
        opacity: 0;
        transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1);
    }

    #full-menu.active {
        visibility: visible;
        opacity: 1;
    }

    .menu-link {
        font-size: 2.5rem;
        font-weight: 900;
        margin: 0.8rem 0;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        color: rgba(255,255,255,0.3);
        text-decoration: none;
        transition: 0.4s;
    }

    .menu-link:hover, .menu-link.active-page {
        color: white;
        transform: translateX(10px);
    }

    /* --- RESPONSIVE --- */
    @media (max-width: 480px) {
        .vakt-card { padding: 1rem 0.5rem; min-height: 110px; }
        .menu-link { font-size: 1.8rem; }
        .progress-container { width: 180px; height: 180px; }
    }

    .opacity-30 { opacity: 0.3; filter: grayscale(0.8); }
</style>
</head>

<div id="intro-screen" class="fixed inset-0 z-[5000] flex flex-col items-center justify-center bg-[#020617] transition-all duration-1000">
    <div class="absolute inset-0 opacity-10 pointer-events-none" 
         style="background-image: radial-gradient(circle at 2px 2px, #10b981 1px, transparent 0); background-size: 40px 40px;">
    </div>

    <div class="relative z-10 text-center px-6">
        <div class="mb-8 animate-bounce-slow">
            <div class="w-24 h-24 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto border border-emerald-500/30">
                <i class="fa-solid fa-mosque text-5xl text-emerald-500"></i>
            </div>
        </div>

        <h1 class="text-4xl font-black italic tracking-tighter text-white mb-2">
            Përkujtuesi <span class="text-emerald-500">Ditor</span>
        </h1>
        
        <p class="text-gray-400 text-sm tracking-[0.2em] uppercase mb-12 opacity-0 animate-fade-in">
            Paqja qoftë mbi ju
        </p>

        <button onclick="startApp()" class="group relative px-12 py-4 bg-transparent border border-emerald-500/50 rounded-2xl overflow-hidden transition-all hover:bg-emerald-500">
            <span class="relative z-10 text-emerald-500 font-bold tracking-widest text-xs uppercase group-hover:text-black transition-colors">
                Hyni në Faqe
            </span>
        </button>
    </div>

    <div class="absolute bottom-10">
        <p class="text-[9px] text-gray-600 tracking-[0.5em] uppercase italic">Bismilah</p>
    </div>
</div>

<style>
    /* Animacionet për Intro */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 0.7; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 1.5s ease forwards 0.5s; }
    
    @keyframes bounceSlow {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    .animate-bounce-slow { animation: bounceSlow 3s ease-in-out infinite; }

    /* Zhdukja e Intros */
    .fade-out {
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }
</style>

<script>
    function startApp() {
        const intro = document.getElementById('intro-screen');
        intro.classList.add('fade-out');
        
        // Opsionale: Aktivizo tingullin ose dridhjen kur klikohet
        if (navigator.vibrate) navigator.vibrate(50);
    }
</script>
    
<body class="pb-12">

    <div id="celebration-modal" class="fixed inset-0 z-[3000] hidden items-center justify-center p-8 backdrop-blur-xl bg-black/80">
        <div class="modal-content glass-card p-10 text-center max-w-xs">
            <div class="w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-check text-emerald-500 text-2xl"></i>
            </div>
            <h2 class="text-2xl font-black mb-2 italic">MashAllah!</h2>
            <p class="text-gray-400 text-sm italic">Allahu ta pranoftë ibadetin tënd.</p>
            <button onclick="closeCelebration()" class="mt-8 bg-emerald-500 text-black font-black py-3 px-8 rounded-2xl w-full uppercase tracking-widest text-xs">Amin</button>
        </div>
    </div>

    <div class="menu-trigger" onclick="toggleMenu()">
        <div class="burger-line line-1"></div>
        <div class="burger-line line-2"></div>
        <div class="burger-line line-3"></div>
    </div>

    <div class="menu-trigger" onclick="toggleMenu()">
    <div class="burger-line line-1"></div>
    <div class="burger-line line-2"></div>
    <div class="burger-line line-3"></div>
</div>

<nav id="full-menu">
    <div class="mb-10"><p class="text-emerald-500 font-black tracking-[0.4em] text-xs uppercase opacity-50">Navigimi</p></div>
    <a href="index.html" class="menu-link active-page"><i class="fa-solid fa-house-chimney"></i> Vaktia</a>
    <a href="lutje.html" class="menu-link"><i class="fa-solid fa-hand-holding-heart"></i> Lutjet</a>
    <a href="kibla.html" class="menu-link"><i class="fa-solid fa-compass"></i> Kibla</a>
    <a href="ligjeratat.html" class="menu-link"><i class="fa-solid fa-microphone-lines"></i> Ligjërata</a>
    <a href="info.html" class="menu-link"><i class="fa-solid fa-circle-info"></i> Info</a>
    <div class="mt-auto pt-10 border-t border-white/5">
        <p class="text-[10px] text-gray-500 tracking-widest uppercase italic">Perkujtuesi Ditor &copy; 2026</p>
    </div>
</nav>

    <header class="pt-20 px-8">
        <div class="max-w-md mx-auto mb-10">
            <h2 class="text-5xl font-black tracking-tighter mb-2 italic">Selam Alejkum<span class="text-emerald-500">.</span></h2>
            <p id="hijri-date-top" class="text-[10px] uppercase tracking-[0.3em] text-emerald-500 font-bold opacity-70"></p>
        </div>

        <div class="progress-container mb-12 relative text-center">
            <svg width="220" height="220" class="mx-auto">
                <circle class="text-white/5" stroke-width="2" stroke="currentColor" fill="transparent" r="95" cx="110" cy="110"/>
                <circle id="progress-bar" class="progress-ring__circle" stroke-width="3" stroke-dasharray="596.9" stroke-dashoffset="596.9" stroke-linecap="round" fill="transparent" r="95" cx="110" cy="110" transform="rotate(-90 110 110)"/>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span id="live-clock" class="text-5xl font-black tracking-tighter text-white italic">00:00</span>
                <span class="text-[9px] uppercase tracking-[0.4em] text-gray-500 font-bold mt-2">Koha Lokale</span>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-6 space-y-6">
        <div class="glass-card p-8 text-center relative overflow-hidden bg-gradient-to-br from-white/5 to-transparent">
            <div class="absolute top-0 right-0 p-4 opacity-10">
                <i class="fa-solid fa-mosque text-6xl"></i>
            </div>
            <p class="text-[10px] uppercase tracking-[0.5em] text-emerald-500 font-black mb-2">I Radhës</p>
            <h3 id="next-prayer-name" class="text-5xl font-black italic tracking-tighter mb-4">-</h3>
            <div class="inline-flex items-center gap-3 px-6 py-2 rounded-2xl bg-black/40 border border-white/5">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span id="prayer-countdown" class="text-sm font-bold font-mono tracking-widest text-emerald-500">00:00:00</span>
            </div>
        </div>

        <div id="vaktet-list" class="grid grid-cols-2 gap-4"></div>

        <div class="glass-card p-6">
            <div class="flex justify-between items-center mb-6">
                <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400">Namazi Ditor</h4>
                <p id="task-count" class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">0/5</p>
            </div>
            
            <div class="grid grid-cols-5 gap-3 mb-8">
                <button onclick="toggleTask(0)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black transition-all active:scale-90">S</button>
                <button onclick="toggleTask(1)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black transition-all active:scale-90">D</button>
                <button onclick="toggleTask(2)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black transition-all active:scale-90">I</button>
                <button onclick="toggleTask(3)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black transition-all active:scale-90">A</button>
                <button onclick="toggleTask(4)" class="task-btn h-14 rounded-2xl border border-white/5 bg-white/5 text-[11px] font-black transition-all active:scale-90">J</button>
            </div>

            <div class="pt-6 border-t border-white/5 flex items-center justify-between">
                <div class="flex flex-col">
                    <span id="dhiker-label" class="text-sm font-bold italic text-white leading-tight">SubhanAllah</span>
                    <span class="text-[9px] text-emerald-500 uppercase font-black tracking-widest opacity-60">Dhikri Aktual</span>
                </div>
                <button onclick="incrementTasbih()" class="w-16 h-16 rounded-3xl bg-emerald-500 flex items-center justify-center shadow-xl shadow-emerald-500/20 active:scale-95 transition-all">
                    <span id="tasbih-num" class="text-xl font-black text-slate-900">0</span>
                </button>
            </div>
        </div>

        

<div class="glass-card p-6">
    <div class="flex justify-between items-center mb-5">
        <h4 class="text-[10px] font-black uppercase tracking-[0.3em] text-gray-400">Libraria Islame</h4>
        <i class="fa-solid fa-book-open text-emerald-500 text-xs opacity-50"></i>
    </div>
    
    <div class="grid grid-cols-2 gap-3">
        <div onclick="openLibrary('suret')" class="bg-white/5 border border-white/5 rounded-2xl p-4 transition-all active:scale-95 cursor-pointer hover:bg-emerald-500/10 group">
            <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center mb-3 group-hover:bg-emerald-500 group-hover:text-black transition-colors">
                <i class="fa-solid fa-book-quran"></i>
            </div>
            <h5 class="text-sm font-bold italic">Suret</h5>
            <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-1">Lexim & Dëgjim</p>
        </div>

        <div onclick="openLibrary('duate')" class="bg-white/5 border border-white/5 rounded-2xl p-4 transition-all active:scale-95 cursor-pointer hover:bg-blue-500/10 group">
            <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center mb-3 group-hover:bg-blue-500 group-hover:text-black transition-colors">
                <i class="fa-solid fa-hands-praying"></i>
            </div>
            <h5 class="text-sm font-bold italic">Duatë</h5>
            <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-1">Mburoja ditore</p>
        </div>

        <div onclick="openLibrary('emrat')" class="bg-white/5 border border-white/5 rounded-2xl p-4 transition-all active:scale-95 cursor-pointer hover:bg-amber-500/10 group">
            <div class="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center mb-3 group-hover:bg-amber-500 group-hover:text-black transition-colors">
                <i class="fa-solid fa-star-and-crescent"></i>
            </div>
            <h5 class="text-sm font-bold italic">99 Emrat</h5>
            <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-1">Dija e Allahut</p>
        </div>

        <div onclick="openLibrary('hadithe')" class="bg-white/5 border border-white/5 rounded-2xl p-4 transition-all active:scale-95 cursor-pointer hover:bg-purple-500/10 group">
            <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center mb-3 group-hover:bg-purple-500 group-hover:text-black transition-colors">
                <i class="fa-solid fa-quote-left"></i>
            </div>
            <h5 class="text-sm font-bold italic">Hadithe</h5>
            <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-1">Thënie Profetike</p>
        </div>
    </div>
</div>

        
        <div class="glass-card p-8">
            <h4 class="text-[10px] uppercase tracking-[0.4em] text-gray-500 font-bold mb-6">Analitika Ditore</h4>
            <div class="flex items-end gap-3 h-16 mb-6 px-2">
                <div class="flex-1 bg-emerald-500/10 rounded-t-lg h-[40%]"></div>
                <div class="flex-1 bg-emerald-500/20 rounded-t-lg h-[70%]"></div>
                <div class="flex-1 bg-emerald-500/40 rounded-t-lg h-[100%] border-t-2 border-emerald-500"></div>
                <div class="flex-1 bg-emerald-500/20 rounded-t-lg h-[60%]"></div>
                <div class="flex-1 bg-emerald-500/10 rounded-t-lg h-[30%]"></div>
            </div>
            <p id="quote-text" class="text-gray-400 text-xs italic font-medium leading-relaxed border-l-2 border-emerald-500/30 pl-4">
                "Përmendeni Allahun që Ai t'ju përmend juve."
            </p>
        </div>

<div id="sure-modal" class="fixed inset-0 z-[6000] hidden items-center justify-center p-6 backdrop-blur-3xl bg-[#020617]/90">
    <div class="glass-card w-full max-w-sm p-8 relative border-emerald-500/20 shadow-2xl shadow-emerald-500/5">
        
        <div class="text-center mb-6">
            <div id="sure-icon-bg" class="w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-500/30">
                <i id="sure-main-icon" class="fa-solid fa-book-quran text-3xl text-emerald-500"></i>
            </div>
            <h3 id="sure-title" class="text-3xl font-black italic tracking-tighter">Sureja...</h3>
            <p id="sure-rendesia" class="text-[10px] text-emerald-500/70 uppercase tracking-[0.2em] mt-2 font-bold px-4"></p>
        </div>

        <div class="relative bg-black/20 rounded-2xl p-6 border border-white/5">
            <i class="fa-solid fa-quote-left absolute top-4 left-4 opacity-10 text-4xl"></i>
            <div id="sure-content" class="text-gray-200 text-sm leading-relaxed text-center italic font-medium max-h-48 overflow-y-auto custom-scrollbar">
                </div>
        </div>

        <button onclick="closeSure()" class="mt-8 w-full py-4 bg-emerald-500 text-black font-black rounded-2xl uppercase tracking-widest text-[11px] hover:scale-[1.02] active:scale-95 transition-all">
            Elhamdulillah, u lexua
        </button>
    </div>

</div>

    </main>

    <script>
    // --- KONFIGURIMI DHE VARIABLAT GLOBALE ---
    const vaktetRaw = [
        { emri: 'Sabahu', koha: '05:30', ikona: 'fa-cloud-sun', gradient: 'linear-gradient(135deg, #1e3c72, #2a5298)' },
        { emri: 'Lindja', koha: '07:05', ikona: 'fa-sun', gradient: 'linear-gradient(135deg, #ff9966, #ff5e62)' },
        { emri: 'Dreka', koha: '11:48', ikona: 'fa-sun', gradient: 'linear-gradient(135deg, #4facfe, #00f2fe)' },
        { emri: 'Ikindia', koha: '14:12', ikona: 'fa-cloud-sun', gradient: 'linear-gradient(135deg, #f093fb, #f5576c)' },
        { emri: 'Akshami', koha: '16:21', ikona: 'fa-mountain-sun', gradient: 'linear-gradient(135deg, #434343, #000000)' },
        { emri: 'Jacia', koha: '17:54', ikona: 'fa-moon', gradient: 'linear-gradient(135deg, #0f2027, #2c5364)' }
    ];

    let lastNotifiedVakt = "";
    const dhikret = ["SubhanAllah", "Elhamdulillah", "Allahu Akbar", "Estagfirullah", "La ilaha illallah"];
    let dhikerIndex = 0;
    let tasbihCount = parseInt(localStorage.getItem('tasbihCount')) || 0;
    let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [false, false, false, false, false];

    // --- FUNKSIONI KRYESOR I PËRDITËSIMIT (ÇDO SEKONDË) ---
    function updateUI() {
        const now = new Date();
        const currentTotalMin = (now.getHours() * 60) + now.getMinutes();
        const kohaTaniStr = now.toLocaleTimeString('sq-AL', { hour12: false, hour: '2-digit', minute: '2-digit' });

        // Përditëso orën live
        document.getElementById('live-clock').innerText = kohaTaniStr;

        // 1. Logjika e Njoftimeve
        vaktetRaw.forEach(v => {
            if (kohaTaniStr === v.koha && lastNotifiedVakt !== v.emri) {
                lastNotifiedVakt = v.emri;
                sendImpulsiveNotification(v.emri);
                activateFocusMode(v.emri);
            }
        });

        // Reset njoftimin kur kalon minuta
        if (lastNotifiedVakt !== "" && vaktetRaw.every(v => kohaTaniStr !== v.koha)) {
            lastNotifiedVakt = "";
        }

        // 2. Gjenerimi i Kartave të Vakteve
        let currentIdx = -1;
        const listHtml = vaktetRaw.map((v, i) => {
            const [vh, vm] = v.koha.split(':').map(Number);
            const vMin = vh * 60 + vm;
            if (currentTotalMin >= vMin) currentIdx = i;

            const isNow = (i === currentIdx);
            const passed = (currentTotalMin > vMin) && !isNow;

            const cardStyle = isNow ? `style="background: ${v.gradient}; border: none; transform: scale(1.05); box-shadow: 0 15px 30px rgba(0,0,0,0.4); z-index: 10;"` : '';
            const iconStyle = isNow ? `style="background: rgba(255,255,255,0.2); color: white; filter: drop-shadow(0 0 8px white);"` : '';
            const textStyle = isNow ? `style="color: white; opacity: 1;"` : '';

            return `
                <div class="glass-card vakt-card ${isNow ? 'active' : ''} ${passed ? 'opacity-30' : ''}" ${cardStyle}>
                    <div class="vakt-icon-container" ${iconStyle}>
                        <i class="fa-solid ${v.ikona}"></i>
                    </div>
                    <span class="text-[9px] uppercase font-black tracking-[0.2em] ${isNow ? '' : 'text-gray-500'} block mb-1" ${textStyle}>${v.emri}</span>
                    <span class="text-xl font-bold italic tracking-tight" ${textStyle}>${v.koha}</span>
                </div>`;
        }).join('');

        document.getElementById('vaktet-list').innerHTML = listHtml;

        // 3. Countdown dhe Progress Ring
        updateNextPrayer(now, currentIdx);
    }

    function updateNextPrayer(now, currentIdx) {
        const nextIdx = (currentIdx + 1) % vaktetRaw.length;
        const nextP = vaktetRaw[nextIdx];
        document.getElementById('next-prayer-name').innerText = nextP.emri;

        const [nh, nm] = nextP.koha.split(':').map(Number);
        let target = new Date();
        target.setHours(nh, nm, 0);
        if (target < now) target.setDate(target.getDate() + 1);

        const diff = target - now;
        const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
        const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
        const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
        document.getElementById('prayer-countdown').innerText = `${h}:${m}:${s}`;

        const totalSec = (now.getHours() * 3600) + (now.getMinutes() * 60) + now.getSeconds();
        const offset = 596.9 - ((totalSec / 86400) * 596.9);
        document.getElementById('progress-bar').style.strokeDashoffset = offset;
    }

    // --- SISTEMI I TASBIHUT DHE NAMAZIT ---
    function incrementTasbih() {
        tasbihCount++;
        if (navigator.vibrate) navigator.vibrate(20);
        if (tasbihCount > 33) {
            tasbihCount = 1;
            dhikerIndex = (dhikerIndex + 1) % dhikret.length;
            document.getElementById('dhiker-label').innerText = dhikret[dhikerIndex];
        }
        document.getElementById('tasbih-num').innerText = tasbihCount;
        localStorage.setItem('tasbihCount', tasbihCount);
    }

    function toggleTask(idx) {
        completedTasks[idx] = !completedTasks[idx];
        localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
        updateTasksUI();
        if (completedTasks.filter(t => t).length === 5) showCelebration();
    }

    function updateTasksUI() {
        const btns = document.querySelectorAll('.task-btn');
        completedTasks.forEach((s, i) => {
            s ? btns[i].classList.add('done') : btns[i].classList.remove('done');
        });
        document.getElementById('task-count').innerText = `${completedTasks.filter(t => t).length}/5 Namaze`;
    }

    // --- MODALET DHE NAVIGIMI ---
    function toggleMenu() {
        const menu = document.getElementById('full-menu');
        const trigger = document.querySelector('.menu-trigger');
        trigger.classList.toggle('open');
        menu.classList.toggle('active');
        document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : 'auto';
    }

    function openSure(ora) {
        const sure = sureatDitore[ora];
        if (!sure) return;
        document.getElementById('sure-title').innerText = sure.titulli;
        document.getElementById('sure-rendesia').innerText = sure.rendesia;
        document.getElementById('sure-content').innerText = sure.teksti;
        document.getElementById('sure-main-icon').className = `fa-solid ${sure.ikona} text-3xl text-emerald-500`;
        document.getElementById('sure-modal').style.display = 'flex';
        if (navigator.vibrate) navigator.vibrate(100);
    }

    function closeSure() { document.getElementById('sure-modal').style.display = 'none'; }
    function showCelebration() { document.getElementById('celebration-modal').style.display = 'flex'; }
    function closeCelebration() { document.getElementById('celebration-modal').style.display = 'none'; }

    // --- API DHE SINKRONIZIMI ---
    async function fetchLiveVaktet() {
        try {
            const metoda = localStorage.getItem('zenith_api_method') || '13';
            const offset = parseInt(localStorage.getItem('zenith_offset')) || 0;
            const res = await fetch(`https://api.aladhan.com/v1/timingsByAddress?address=Ratkoc,Kosovo&method=${metoda}`);
            const data = await res.json();
            const t = data.data.timings;

            const applyOffset = (timeStr) => {
                let [h, m] = timeStr.split(':').map(Number);
                let d = new Date();
                d.setHours(h, m + offset);
                return d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
            };

            const map = { Fajr: 0, Sunrise: 1, Dhuhr: 2, Asr: 3, Maghrib: 4, Isha: 5 };
            const vKeys = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            vKeys.forEach((key, idx) => { vaktetRaw[idx].koha = applyOffset(t[key]); });

            updateUI();
            updateLockScreenWidget();
        } catch (e) { console.error("API Error"); }
    }

    // --- NJOFTIMET DHE FOCUS MODE ---
    function activateFocusMode(vaktiEmri) {
        const cards = document.querySelectorAll('.vakt-card');
        cards.forEach(card => {
            if (card.innerText.includes(vaktiEmri)) {
                card.classList.add('vakt-impulse');
                setTimeout(() => card.classList.remove('vakt-impulse'), 60000);
            }
        });
        if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 300]);
    }

    function sendImpulsiveNotification(emri) {
        if (Notification.permission === "granted") {
            new Notification(`ALLAHU EKBER!`, {
                body: `Hyri koha e namazit të ${emri}.`,
                icon: 'Images/604776747_122280490772225847_4370550408157022665_n.jpg'
            });
        }
    }

    async function updateLockScreenWidget() {
        if ('serviceWorker' in navigator && Notification.permission === "granted") {
            const reg = await navigator.serviceWorker.ready;
            const tani = new Date();
            const oraTani = tani.getHours() * 3600 + tani.getMinutes() * 60;
            let vradhes = vaktetRaw.find(v => {
                const [vO, vM] = v.koha.split(':').map(Number);
                return (vO * 3600 + vM * 60) > oraTani;
            }) || vaktetRaw[0];

            reg.showNotification(`Vaktia: ${vradhes.emri}`, {
                body: `Koha: ${vradhes.koha}`,
                tag: 'vaktia-live',
                silent: true
            });
        }
    }

    // --- INITIALIZATION ---
    window.onload = () => {
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        fetchLiveVaktet();
        updateTasksUI();
        
        const options = { day: 'numeric', month: 'long', year: 'numeric', calendar: 'islamic-uma' };
        document.getElementById('hijri-date-top').innerText = new Intl.DateTimeFormat('sq-u-ca-islamic-uma', options).format(new Date());
        
        setInterval(updateUI, 1000);
        setInterval(updateLockScreenWidget, 60000);
        window.onfocus = () => fetchLiveVaktet();
    };

    const sureatDitore = {
        12: { titulli: "Sureja El-Ihlas", teksti: "Ai, Allahu është Një!...", rendesia: "Vlen sa 1/3 e Kuranit.", ikona: "fa-sun" },
        17: { titulli: "Sureja El-Felek & En-Nas", teksti: "I mbështetem Zotit të agimit...", rendesia: "Mbrojtje nga zilija.", ikona: "fa-shield-halved" },
        20: { titulli: "Sureja El-Mulk", teksti: "I Madhëruar është Ai...", rendesia: "Mbrojtje nga dënimi i varrit.", ikona: "fa-moon" }
    };


function openLibrary(kategoria) {
    const modal = document.getElementById('sure-modal');
    const title = document.getElementById('sure-title');
    const content = document.getElementById('sure-content');
    const rendesia = document.getElementById('sure-rendesia');
    const icon = document.getElementById('sure-main-icon');

    // Pastrojmë përmbajtjen paraprake
    content.innerHTML = "";
    content.innerText = "";

    if (kategoria === 'emrat') {
        title.innerText = "99 Emrat e Allahut";
        rendesia.innerText = "Mësimi i tyre është shkak për Xhenet";
        icon.className = "fa-solid fa-star-and-crescent text-3xl text-amber-500";
        content.innerHTML = `
            <div class="grid grid-cols-2 gap-2 text-[11px]">
                <div class="bg-white/5 p-2 rounded-lg border border-white/5 text-center">1. Er-Rahman</div>
                <div class="bg-white/5 p-2 rounded-lg border border-white/5 text-center">2. Er-Rahim</div>
                <div class="bg-white/5 p-2 rounded-lg border border-white/5 text-center">3. El-Melik</div>
                <div class="bg-white/5 p-2 rounded-lg border border-white/5 text-center">4. El-Kuddus</div>
                <div class="bg-white/5 p-2 rounded-lg border border-white/5 text-center">5. Es-Selam</div>
                <div class="bg-white/10 p-2 rounded-lg border border-emerald-500/20 text-center col-span-2 italic">Dhe të tjerët...</div>
            </div>
        `;
    } else if (kategoria === 'duate') {
        title.innerText = "Lutja e Mëngjesit";
        rendesia.innerText = "Mbrojtje nga çdo e keqe";
        icon.className = "fa-solid fa-hands-praying text-3xl text-blue-500";
        content.innerText = "Bismil-lahil-ledhi la jedur-ru me'as-mihi shej'un fil-erdi we la fis-semai we Huwes-Semi'ul-'Alim.";
    } else if (kategoria === 'suret') {
        title.innerText = "Suret e Zgjedhura";
        rendesia.innerText = "Për lexim ditor";
        icon.className = "fa-solid fa-book-quran text-3xl text-emerald-500";
        content.innerText = "Këtu mund të listoni suret si Jasin, El-Mulk, dhe sureat e shkurtra për namaz.";
    } else if (kategoria === 'hadithe') {
        title.innerText = "Hadithi i Ditës";
        rendesia.innerText = "Udhëzim profetik";
        icon.className = "fa-solid fa-quote-left text-3xl text-purple-500";
        content.innerText = "Veprat vlerësohen sipas qëllimit (Nijetit). Çdo njeri do të shpërblehet sipas asaj që ka pasur për qëllim.";
    }

    modal.style.display = 'flex';
    if (navigator.vibrate) navigator.vibrate(50);
}
        
</script>

</body>
</html>









